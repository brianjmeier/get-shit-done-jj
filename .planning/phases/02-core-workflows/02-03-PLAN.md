---
phase: 02-core-workflows
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified: [get-shit-done/workflows/complete-milestone.md, get-shit-done/workflows/plan-phase.md]
autonomous: true
---

<objective>
Update milestone completion and phase planning workflows to use JJ commands.

Purpose: These workflows handle git tags and planning commits. Converting them completes the core workflow layer.

Output: complete-milestone.md and plan-phase.md using JJ patterns
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-jj-foundation/01-01-SUMMARY.md

# JJ reference
@get-shit-done/references/jj-integration.md

# Files to modify
@get-shit-done/workflows/complete-milestone.md
@get-shit-done/workflows/plan-phase.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update complete-milestone.md workflow for JJ</name>
  <files>get-shit-done/workflows/complete-milestone.md</files>
  <action>
Replace git commands with JJ (15 git references):

**Stats gathering (gather_stats step):**
- `git log --oneline` → `jj log --no-graph -T 'commit_id.short() " " description.first_line()'`
- `git diff --stat` → `jj diff --stat`

**Git tag (git_tag step):**
JJ uses bookmarks, not tags. For release tagging:
- `git tag -a v[X.Y] -m "..."` → `jj bookmark create v[X.Y] && jj describe -m "..."`
  OR for git-compatible tags: Create tag in .git directly since colocated

Recommended approach for releases:
```bash
# Create bookmark at current commit
jj bookmark create v[X.Y]
# Push bookmark to remote (acts like tag)
jj git push --bookmark v[X.Y] --allow-new
```

**Milestone commit (git_commit_milestone step):**
- `git add .planning/...` → Remove staging commands
- `git commit -m "chore: complete v[X.Y]..."` → `jj commit -m "chore: complete v[X.Y]..."`

**Push to remote:**
- `git push origin v[X.Y]` → `jj git push --bookmark v[X.Y]`
  </action>
  <verify>
grep -c "git add" get-shit-done/workflows/complete-milestone.md should return 0
grep -c "git commit" get-shit-done/workflows/complete-milestone.md should return 0
grep -c "jj " get-shit-done/workflows/complete-milestone.md should return > 5
  </verify>
  <done>
complete-milestone.md uses JJ for commits, bookmarks (tags), and remote push.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update plan-phase.md workflow for JJ commits</name>
  <files>get-shit-done/workflows/plan-phase.md</files>
  <action>
Replace git commands with JJ (4 git references):

**Plan commit (git_commit step):**
- `git add .planning/phases/...` → Remove staging commands
- `git commit -m "docs(${PHASE}): create phase plan..."` → `jj commit -m "docs(${PHASE}): create phase plan..."`

Keep same commit message format.
  </action>
  <verify>
grep -c "git add" get-shit-done/workflows/plan-phase.md should return 0
grep -c "jj commit" get-shit-done/workflows/plan-phase.md should return 1
  </verify>
  <done>
plan-phase.md uses JJ commit for plan creation.
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] complete-milestone.md uses JJ bookmarks for version tags
- [ ] complete-milestone.md commits with `jj commit`
- [ ] plan-phase.md commits with `jj commit`
- [ ] No `git add` or `git commit` references remain
</verification>

<success_criteria>
- Milestone workflow uses JJ bookmarks for version tagging
- All commits use `jj commit`
- Git log/diff commands use JJ equivalents
- No git references remain in these files
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-workflows/02-03-SUMMARY.md`
</output>
