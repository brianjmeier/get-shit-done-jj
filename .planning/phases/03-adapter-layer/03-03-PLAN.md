---
phase: 03-adapter-layer
plan: 03
type: execute
wave: 2
depends_on: ["03-01", "03-02"]
files_modified: [bin/install.js, package.json]
autonomous: true
---

<objective>
Create unified installer with client detection for Claude Code and OpenCode.

Purpose: Single installation command that detects the target client and installs appropriate files.
Output: bin/install.js installer script and package.json for npm publishing.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-adapter-layer/03-01-SUMMARY.md
@.planning/phases/03-adapter-layer/03-02-SUMMARY.md

@adapters/opencode/README.md
@get-shit-done/references/adapter-architecture.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create installer script with client detection</name>
  <files>bin/install.js</files>
  <action>
    Create bin/install.js with the following functionality:

    1. **Argument parsing**:
       - `--claude-code` or `-c`: Force Claude Code installation
       - `--opencode` or `-o`: Force OpenCode installation
       - `--global` or `-g`: Install globally (default)
       - `--local` or `-l`: Install to current project
       - No flags: Interactive prompt to select client

    2. **Path resolution**:
       - Claude Code global: `~/.claude/`
       - Claude Code local: `.claude/`
       - OpenCode global: `~/.config/opencode/`
       - OpenCode local: `.opencode/`

    3. **Installation logic**:
       - Copy `get-shit-done/` to target path
       - Copy appropriate commands from `commands/gsd/` (Claude Code) or `adapters/opencode/command/gsd/` (OpenCode)
       - Create directories if needed
       - Report success with usage instructions

    4. **Dependencies**: Use only Node.js built-ins (fs, path, readline)

    Use ES modules (import/export). Include shebang: `#!/usr/bin/env node`
  </action>
  <verify>node bin/install.js --help shows usage</verify>
  <done>Installer script created with client detection and path resolution</done>
</task>

<task type="auto">
  <name>Task 2: Create package.json for npm publishing</name>
  <files>package.json</files>
  <action>
    Create package.json with:

    ```json
    {
      "name": "gsd-jj",
      "version": "1.0.0",
      "description": "GSD (Get Shit Done) context engineering framework with JJ (Jujutsu) VCS - supports Claude Code and OpenCode",
      "bin": {
        "gsd-jj": "bin/install.js"
      },
      "type": "module",
      "engines": {
        "node": ">=16.7.0"
      },
      "files": [
        "bin",
        "commands",
        "adapters",
        "get-shit-done"
      ],
      "keywords": ["gsd", "jujutsu", "jj", "claude-code", "opencode", "context-engineering"],
      "license": "MIT",
      "repository": {
        "type": "git",
        "url": "https://github.com/OWNER/gsd-jj.git"
      }
    }
    ```

    Replace OWNER with appropriate GitHub username/org when known.
    The bin entry allows: `npx gsd-jj` or `npx gsd-jj --opencode`
  </action>
  <verify>node -e "console.log(require('./package.json').bin)" shows gsd-jj entry</verify>
  <done>package.json created for npm publishing</done>
</task>

<task type="auto">
  <name>Task 3: Add installation test script</name>
  <files>bin/test-install.js</files>
  <action>
    Create bin/test-install.js that:

    1. Creates temp directories for both clients
    2. Runs install.js with --claude-code to temp dir
    3. Runs install.js with --opencode to temp dir
    4. Verifies expected files exist in each
    5. Cleans up temp directories
    6. Reports pass/fail

    This is a simple smoke test, not full test suite.
    Use Node.js built-ins only.
  </action>
  <verify>node bin/test-install.js exits with code 0</verify>
  <done>Installation test script created and passing</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] bin/install.js created and executable
- [ ] package.json valid JSON with correct structure
- [ ] Test script passes
- [ ] All changes committed atomically
</verification>

<success_criteria>

- Installer detects client type
- Installation works for both Claude Code and OpenCode
- package.json ready for npm publish
- Test script validates installation
</success_criteria>

<output>
After completion, create `.planning/phases/03-adapter-layer/03-03-SUMMARY.md`
</output>
